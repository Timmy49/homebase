<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Hub ‚Äî Wordle ¬∑ Globle ¬∑ Daily Gazette</title>
  <meta name="description" content="A modern dashboard for daily games and news: NYT Wordle, Globle, and automated daily gazette fetching with enhanced UI." />
  <style>
    :root {
      --bg: #0a0e1a; --card: #1a1f2e; --muted: #94a3b8; --text: #f1f5f9; --accent: #3b82f6; --success: #10b981; --warning: #f59e0b; --error: #ef4444;
      --border: #334155; --hover: #475569;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text);
      line-height: 1.6;
    }
    .header { background: rgba(15,23,42,0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); padding: 1rem 2rem; position: sticky; top: 0; z-index: 100; }
    .header-content { max-width: 1400px; margin: 0 auto; display:flex; align-items:center; justify-content:space-between; }
    .logo { font-size: 1.5rem; font-weight:700; background: linear-gradient(135deg, var(--accent), #8b5cf6); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .status-indicator { display:flex; align-items:center; gap:0.5rem; font-size:0.875rem; color:var(--muted); }
    .status-dot { width:8px; height:8px; border-radius:50%; background:var(--success); animation:pulse 2s infinite; }

    .main-container { max-width: 1400px; margin: 0 auto; padding: 2rem; min-height: calc(100vh - 80px); }
    .dashboard-grid { display:grid; grid-template-columns:1fr 1fr; grid-template-rows:auto auto; gap:2rem; height:100%; }

    .game-card, .gazette-card { background: var(--card); border:1px solid var(--border); border-radius:1rem; overflow:hidden; box-shadow:0 10px 25px rgba(0,0,0,0.3); display:flex; flex-direction:column; min-height:500px; }
    .card-header { padding:1.5rem; border-bottom:1px solid var(--border); background: rgba(59,130,246,0.05); }
    .card-title { font-size:1.25rem; font-weight:600; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.75rem; }
    .card-subtitle { color:var(--muted); font-size:0.875rem; }
    .card-controls { display:flex; gap:0.75rem; margin-top:1rem; flex-wrap:wrap; }

    .btn { display:inline-flex; align-items:center; gap:0.5rem; padding:0.5rem 1rem; border-radius:0.5rem; font-size:0.875rem; font-weight:500; cursor:pointer; transition:all 0.2s ease; border:1px solid transparent; text-decoration:none; color:var(--text); background:transparent; }
    .btn-primary { background: var(--accent); color:white; border-color:var(--accent); }
    .btn-secondary { background:transparent; color:var(--muted); border-color:var(--border); }
    .btn-primary:hover { background:#2563eb; transform:translateY(-1px); }
    .btn-secondary:hover { background:var(--hover); color:var(--text); }

    .game-frame { flex:1; width:100%; border:none; background:var(--bg); min-height:500px; }
    .fallback-content { flex:1; padding:2rem; text-align:center; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:1.5rem; }
    .fallback-content.hidden { display:none; }
    .wordle-info { background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.3); border-radius: 0.75rem; padding: 1.5rem; max-width: 400px; }
    .wordle-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
    .stat-item { text-align: center; }
    .stat-number { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
    .stat-label { font-size: 0.875rem; color: var(--muted); }

    /* Gazette specifics */
    .gazette-toolbar { padding:1rem 1.5rem; border-bottom:1px solid var(--border); display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    .input-field { flex:1; padding:0.6rem 0.75rem; background: rgba(15,23,42,0.8); border:1px solid var(--border); border-radius:0.5rem; color:var(--text); font-size:0.875rem; }
    .small-input { width:260px; }
    .mini { padding:0.35rem 0.5rem; font-size:0.82rem; }

    .gazette-content { display:flex; flex-direction:column; flex:1; }
    .gazette-viewer { flex:1; display:grid; grid-template-columns: 340px 1fr; gap:1rem; padding:1rem; }
    .left-col { display:flex; flex-direction:column; gap:1rem; }
    .list-card, .detail-card, .html-card { background: rgba(15,23,42,0.5); border:1px solid var(--border); border-radius:0.75rem; overflow:hidden; display:flex; flex-direction:column; }
    .panel-header { padding:0.85rem 1rem; border-bottom:1px solid var(--border); font-weight:600; font-size:0.9rem; background: rgba(59,130,246,0.06); }
    .panel-content { padding:0.8rem; overflow:auto; max-height:520px; }

    .gazette-list-item { padding:0.6rem; border-radius:6px; display:flex; justify-content:space-between; gap:0.5rem; cursor:pointer; border:1px solid transparent; }
    .gazette-list-item:hover { background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.02); }
    .gazette-selected { background: rgba(59,130,246,0.08); border-color: rgba(59,130,246,0.08); }

    .html-iframe { width:100%; height:560px; border:none; background:white; }

    .meta { color:var(--muted); font-size:0.85rem; }
    .status-badge { display:inline-flex; align-items:center; gap:0.5rem; padding:0.25rem 0.75rem; border-radius:1rem; font-size:0.75rem; font-weight:500; }
    .status-loading { background:rgba(59,130,246,0.1); color:var(--accent); }
    .status-success { background:rgba(16,185,129,0.1); color:var(--success); }
    .status-error { background:rgba(239,68,68,0.1); color:var(--error); }

    .loading { display:flex; align-items:center; justify-content:center; padding:2rem; color:var(--muted); }
    .spinner { width:18px; height:18px; border:2px solid var(--border); border-top:2px solid var(--accent); border-radius:50%; animation:spin 1s linear infinite; margin-right:0.5rem; }

    @media (max-width:1024px) { .dashboard-grid{grid-template-columns:1fr;} .gazette-viewer{grid-template-columns:1fr; } .html-iframe{height:360px;} }

    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

    ::-webkit-scrollbar { width:8px; } ::-webkit-scrollbar-track { background: var(--bg); } ::-webkit-scrollbar-thumb { background: var(--border); border-radius:4px; } ::-webkit-scrollbar-thumb:hover { background: var(--hover); }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo">Daily Hub</div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>Live Dashboard</span>
      </div>
    </div>
  </header>

  <main class="main-container">
    <div class="dashboard-grid">
      <!-- Enhanced Wordle card with fallback -->
      <div class="game-card" id="wordle-card">
        <div class="card-header">
          <div class="card-title"> üéØ Wordle
            <span class="status-badge status-error" id="wordle-status">Embedding Blocked</span>
          </div>
          <div class="card-subtitle">Daily word puzzle from The New York Times</div>
          <div class="card-controls">
            <a class="btn btn-primary" href="https://www.nytimes.com/games/wordle/index.html" target="_blank">üéÆ Play Wordle</a>
            <button class="btn btn-secondary" onclick="fetchWordleInfo()">üìä Get Today's Info</button>
            <button class="btn btn-secondary" onclick="tryWordleEmbed()">üîÑ Try Embed</button>
          </div>
        </div>
        
        <iframe id="wordle-frame" class="game-frame" style="display:none;" title="Wordle Game"></iframe>
        
        <div class="fallback-content" id="wordle-fallback">
          <div class="wordle-info">
            <h3>üéØ Today's Wordle</h3>
            <p>NYTimes blocks direct embedding, but you can:</p>
            <div class="wordle-stats">
              <div class="stat-item">
                <div class="stat-number" id="wordle-number">---</div>
                <div class="stat-label">Puzzle #</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="wordle-date">Today</div>
                <div class="stat-label">Date</div>
              </div>
            </div>
            <p><strong>Click "Play Wordle" above</strong> to open in a new tab</p>
            <p class="meta">This is the official, secure way to play Wordle</p>
          </div>
        </div>
      </div>

      <div class="game-card" id="globle-card">
        <div class="card-header">
          <div class="card-title"> üåç Globle
            <span class="status-badge status-loading" id="globle-status"><div class="spinner"></div>Loading</span>
          </div>
          <div class="card-subtitle">Daily geography guessing game</div>
          <div class="card-controls">
            <button class="btn btn-primary" onclick="refreshGlobe()">üîÑ Refresh</button>
            <a class="btn btn-secondary" href="https://globle-game.com/" target="_blank">üîó Open Direct</a>
          </div>
        </div>
        <iframe id="globle-frame" class="game-frame" src="https://globle-game.com/" title="Globle Game" loading="lazy"></iframe>
        <div class="fallback-content hidden" id="globle-fallback">
          <h3>üåç Unable to load Globle</h3>
          <p>The game might be blocked by your browser or network settings.</p>
          <a class="btn btn-primary" href="https://globle-game.com/" target="_blank">üîó Open Globle Directly</a>
        </div>
      </div>

      <!-- Gazette Card (unchanged) -->
      <div class="gazette-card">
        <div class="card-header">
          <div class="card-title"> üì∞ Daily Gazette
            <span class="status-badge status-loading" id="gazette-status"><div class="spinner"></div>Fetching</span>
          </div>
          <div class="card-subtitle">Auto-fetch via JSON-RPC ‚Äî paste URL and auth headers if site requires login</div>
          <div class="card-controls">
            <button class="btn btn-primary" onclick="fetchGazette()">üîÑ Refresh Gazette</button>
            <button class="btn btn-secondary" onclick="toggleGazetteView()">üëÅÔ∏è Toggle View</button>
          </div>
        </div>

        <div class="gazette-content">
          <div class="gazette-toolbar">
            <input id="gazette-url" class="input-field" placeholder="JSON-RPC or direct Gazette URL (e.g. https://www.ofs.edu.sg/my-ofs/Gazette.jsp?gazetteId=5960)" value="https://www.ofs.edu.sg/my-ofs/Gazette.jsp?gazetteId=5960" />
            <input id="known-id" class="input-field small-input" placeholder="start gazetteId (optional, e.g. 5916)" />
            <input id="cookie-header" class="input-field small-input" placeholder="b7Xr_65wyJ2tyPJ90ak2gOHsat2fCxN5ZkceFpLY.app-prd-new" />
            <button class="btn btn-primary mini" onclick="fetchGazette()">Fetch</button>
            <button class="btn btn-secondary mini" onclick="discoverLatest()">Find latest accessible ID</button>
            <button class="btn mini" onclick="loadDemoGazette()">Load Demo</button>
          </div>

          <div class="gazette-viewer">
            <div class="left-col">
              <div class="list-card">
                <div class="panel-header">Gazette Index</div>
                <div id="gazette-list" class="panel-content">
                  <div class="meta">No gazettes loaded yet. Use 'Fetch' or 'Find latest accessible ID'.</div>
                </div>
              </div>

              <div class="detail-card">
                <div class="panel-header">Gazette Meta</div>
                <div id="gazette-meta" class="panel-content">
                  <div class="meta">Select a gazette from the list to see metadata.</div>
                </div>
              </div>
            </div>

            <div class="html-card">
              <div class="panel-header">HTML Preview</div>
              <div class="panel-content" style="padding:0;">
                <iframe id="gazette-html-frame" class="html-iframe" title="Gazette HTML Content" sandbox="allow-same-origin allow-scripts"></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // --- App state ---
    const AppState = {
      gazetteData: null,
      gazetteUrl: document.getElementById('gazette-url')?.value || '',
      customHeaders: {},
      viewMode: 'split',
      wordleNumber: null
    };

    // --- Wordle handling ---
    function tryWordleEmbed() {
      updateStatus('wordle-status', 'Attempting embed...', 'loading');
      const iframe = document.getElementById('wordle-frame');
      const fallback = document.getElementById('wordle-fallback');
      
      iframe.style.display = 'block';
      fallback.classList.add('hidden');
      
      // Set up timeout to detect if embedding fails
      const timeout = setTimeout(() => {
        iframe.style.display = 'none';
        fallback.classList.remove('hidden');
        updateStatus('wordle-status', 'Embedding blocked by NYTimes', 'error');
      }, 5000);
      
      iframe.onload = () => {
        try {
          // Try to access iframe content to see if it loaded properly
          const doc = iframe.contentDocument || iframe.contentWindow?.document;
          if (doc && doc.title && !doc.title.includes('blocked')) {
            clearTimeout(timeout);
            updateStatus('wordle-status', 'Embedded successfully', 'success');
          } else {
            throw new Error('Blocked');
          }
        } catch (e) {
          // Cross-origin or blocked
          clearTimeout(timeout);
          iframe.style.display = 'none';
          fallback.classList.remove('hidden');
          updateStatus('wordle-status', 'Embedding blocked (CORS)', 'error');
        }
      };
      
      iframe.onerror = () => {
        clearTimeout(timeout);
        iframe.style.display = 'none';
        fallback.classList.remove('hidden');
        updateStatus('wordle-status', 'Failed to load', 'error');
      };
      
      iframe.src = 'https://www.nytimes.com/games/wordle/index.html';
    }

    async function fetchWordleInfo() {
      updateStatus('wordle-status', 'Fetching info...', 'loading');
      try {
        // Calculate Wordle number (Wordle started on June 19, 2021)
        const startDate = new Date('2021-06-19');
        const today = new Date();
        const diffTime = Math.abs(today - startDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        AppState.wordleNumber = diffDays;
        document.getElementById('wordle-number').textContent = diffDays;
        document.getElementById('wordle-date').textContent = today.toLocaleDateString();
        
        updateStatus('wordle-status', 'Info updated', 'success');
      } catch (error) {
        updateStatus('wordle-status', 'Info fetch failed', 'error');
      }
    }

    // --- Globle handling ---
    function setupGameIframe(iframeId, cardId, gameName) {
      const iframe = document.getElementById(iframeId);
      const card = document.getElementById(cardId);
      const fallback = document.getElementById(gameName.toLowerCase() + '-fallback');
      const statusId = `${gameName.toLowerCase()}-status`;
      
      if (!iframe || !card) return;
      
      updateStatus(statusId, 'Loading', 'loading');
      
      const timeout = setTimeout(() => {
        if (fallback) {
          iframe.style.display = 'none';
          fallback.classList.remove('hidden');
        }
        updateStatus(statusId, 'Embedding blocked', 'error');
      }, 8000);
      
      iframe.onload = () => {
        clearTimeout(timeout);
        updateStatus(statusId, 'Loaded successfully', 'success');
      };
      
      iframe.onerror = () => {
        clearTimeout(timeout);
        if (fallback) {
          iframe.style.display = 'none';
          fallback.classList.remove('hidden');
        }
        updateStatus(statusId, 'Failed to load', 'error');
      };
    }

    function refreshGlobe() {
      updateStatus('globle-status', 'Refreshing', 'loading');
      const iframe = document.getElementById('globle-frame');
      const fallback = document.getElementById('globle-fallback');
      
      iframe.style.display = 'block';
      if (fallback) fallback.classList.add('hidden');
      
      iframe.src = iframe.src; // Force reload
    }

    // --- Helper functions ---
    function updateStatus(id, text, kind='loading') {
      const el = document.getElementById(id);
      if (!el) return;
      const classes = { loading: 'status-loading', success: 'status-success', error: 'status-error' };
      el.className = 'status-badge ' + (classes[kind] || classes.loading);
      el.innerHTML = (kind === 'loading' ? '<div class="spinner"></div>' : '') + text;
    }

    function showError(msg, id='gazette-status') {
      console.error('Error:', msg);
      updateStatus(id, 'Error: ' + msg, 'error');
    }

    // --- Gazette functions (keeping existing functionality) ---
    async function fetchWithHeaders(url, opts = {}) {
      const headers = new Headers(opts.headers || {});
      const cookieVal = document.getElementById('cookie-header')?.value.trim();
      if (cookieVal) {
        headers.set('Cookie', cookieVal);
      }
      const fetchOpts = {
        method: opts.method || 'GET',
        headers,
        mode: opts.mode || 'cors',
        credentials: opts.credentials || 'omit',
        cache: 'no-cache'
      };
      return fetch(url, fetchOpts);
    }

    async function fetchGazette() {
      const url = document.getElementById('gazette-url')?.value.trim();
      if (!url) {
        showError('Please enter a gazette URL');
        return;
      }
      
      updateStatus('gazette-status', 'Fetching gazette...', 'loading');
      
      try {
        const response = await fetchWithHeaders(url);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const contentType = response.headers.get('content-type') || '';
        let data;
        
        if (contentType.includes('application/json')) {
          data = await response.json();
        } else {
          const text = await response.text();
          try {
            data = JSON.parse(text);
          } catch {
            data = { html: text, contentType };
          }
        }
        
        AppState.gazetteData = data;
        renderGazetteData(data);
        updateStatus('gazette-status', 'Gazette loaded', 'success');
        
      } catch (error) {
        showError(error.message);
      }
    }

    function renderGazetteData(data) {
      // Implementation for rendering gazette data
      const metaEl = document.getElementById('gazette-meta');
      const listEl = document.getElementById('gazette-list');
      const frameEl = document.getElementById('gazette-html-frame');
      
      if (data.html) {
        frameEl.src = URL.createObjectURL(new Blob([data.html], { type: 'text/html' }));
      }
      
      if (metaEl) {
        metaEl.innerHTML = '<div class="meta">Gazette data loaded successfully</div>';
      }
      
      if (listEl) {
        listEl.innerHTML = '<div class="meta">Gazette content available in preview</div>';
      }
    }

    function loadDemoGazette() {
      updateStatus('gazette-status', 'Loading demo', 'loading');
      const demoHtml = `
        <!DOCTYPE html>
        <html><head><meta charset="utf-8"><title>Demo Gazette</title>
        <style>body{font-family:system-ui;padding:20px;line-height:1.6}h1{color:#1f2937}</style>
        </head><body>
        <h1>Demo Daily Gazette</h1>
        <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
        <p>This is a demo gazette showing how the HTML content would be displayed.</p>
        <h2>Today's Highlights</h2>
        <ul>
          <li>Sample news item 1</li>
          <li>Sample news item 2</li>
          <li>Sample news item 3</li>
        </ul>
        </body></html>
      `;
      
      const frameEl = document.getElementById('gazette-html-frame');
      if (frameEl) {
        frameEl.src = URL.createObjectURL(new Blob([demoHtml], { type: 'text/html' }));
      }
      
      updateStatus('gazette-status', 'Demo loaded', 'success');
    }

    function toggleGazetteView() {
      // Toggle view implementation
      const viewer = document.querySelector('.gazette-viewer');
      if (!viewer) return;
      
      const currentCols = viewer.style.gridTemplateColumns;
      if (currentCols.includes('0')) {
        viewer.style.gridTemplateColumns = '340px 1fr';
      } else {
        viewer.style.gridTemplateColumns = '0 1fr';
      }
    }

    function discoverLatest() {
      showError('Discovery feature needs implementation with your specific endpoint');
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
      // Set up Globle (Wordle is handled differently now)
      setupGameIframe('globle-frame', 'globle-card', 'Globle');
      
      // Initialize Wordle info
      fetchWordleInfo();
      
      // Load demo gazette
      loadDemoGazette();
    });

    // Export functions to window
    window.fetchGazette = fetchGazette;
    window.loadDemoGazette = loadDemoGazette;
    window.toggleGazetteView = toggleGazetteView;
    window.discoverLatest = discoverLatest;
    window.refreshGlobe = refreshGlobe;
    window.tryWordleEmbed = tryWordleEmbed;
    window.fetchWordleInfo = fetchWordleInfo;
  </script>
</body>
</html>
