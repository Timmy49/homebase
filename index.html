<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Hub ‚Äî Wordle ¬∑ Globle ¬∑ Daily Gazette</title>
  <meta name="description" content="A modern dashboard for daily games and news: NYT Wordle, Globle, and automated daily gazette fetching with enhanced UI." />
  <style>
    :root {
      --bg: #0a0e1a; --card: #1a1f2e; --muted: #94a3b8; --text: #f1f5f9; --accent: #3b82f6; --success: #10b981; --warning: #f59e0b; --error: #ef4444;
      --border: #334155; --hover: #475569;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text);
      line-height: 1.6;
    }
    .header { background: rgba(15,23,42,0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); padding: 1rem 2rem; position: sticky; top: 0; z-index: 100; }
    .header-content { max-width: 1400px; margin: 0 auto; display:flex; align-items:center; justify-content:space-between; }
    .logo { font-size: 1.5rem; font-weight:700; background: linear-gradient(135deg, var(--accent), #8b5cf6); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .status-indicator { display:flex; align-items:center; gap:0.5rem; font-size:0.875rem; color:var(--muted); }
    .status-dot { width:8px; height:8px; border-radius:50%; background:var(--success); animation:pulse 2s infinite; }

    .main-container { max-width: 1400px; margin: 0 auto; padding: 2rem; min-height: calc(100vh - 80px); }
    .dashboard-grid { display:grid; grid-template-columns:1fr 1fr; grid-template-rows:auto auto; gap:2rem; height:100%; }

    .game-card, .gazette-card { background: var(--card); border:1px solid var(--border); border-radius:1rem; overflow:hidden; box-shadow:0 10px 25px rgba(0,0,0,0.3); display:flex; flex-direction:column; min-height:500px; }
    .card-header { padding:1.5rem; border-bottom:1px solid var(--border); background: rgba(59,130,246,0.05); }
    .card-title { font-size:1.25rem; font-weight:600; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.75rem; }
    .card-subtitle { color:var(--muted); font-size:0.875rem; }
    .card-controls { display:flex; gap:0.75rem; margin-top:1rem; flex-wrap:wrap; }

    .btn { display:inline-flex; align-items:center; gap:0.5rem; padding:0.5rem 1rem; border-radius:0.5rem; font-size:0.875rem; font-weight:500; cursor:pointer; transition:all 0.2s ease; border:1px solid transparent; text-decoration:none; color:var(--text); background:transparent; }
    .btn-primary { background: var(--accent); color:white; border-color:var(--accent); }
    .btn-secondary { background:transparent; color:var(--muted); border-color:var(--border); }
    .btn-primary:hover { background:#2563eb; transform:translateY(-1px); }
    .btn-secondary:hover { background:var(--hover); color:var(--text); }

    .game-frame { flex:1; width:100%; border:none; background:var(--bg); min-height:500px; }
    .fallback-message { padding:2rem; text-align:center; color:var(--muted); background:rgba(239,68,68,0.1); border:1px dashed #ef4444; margin:1rem; border-radius:0.5rem; display:none; }
    .card.error .fallback-message { display:block; }

    /* Gazette specifics */
    .gazette-toolbar { padding:1rem 1.5rem; border-bottom:1px solid var(--border); display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    .input-field { flex:1; padding:0.6rem 0.75rem; background: rgba(15,23,42,0.8); border:1px solid var(--border); border-radius:0.5rem; color:var(--text); font-size:0.875rem; }
    .small-input { width:260px; }
    .mini { padding:0.35rem 0.5rem; font-size:0.82rem; }

    .gazette-content { display:flex; flex-direction:column; flex:1; }
    .gazette-viewer { flex:1; display:grid; grid-template-columns: 340px 1fr; gap:1rem; padding:1rem; }
    .left-col { display:flex; flex-direction:column; gap:1rem; }
    .list-card, .detail-card, .html-card { background: rgba(15,23,42,0.5); border:1px solid var(--border); border-radius:0.75rem; overflow:hidden; display:flex; flex-direction:column; }
    .panel-header { padding:0.85rem 1rem; border-bottom:1px solid var(--border); font-weight:600; font-size:0.9rem; background: rgba(59,130,246,0.06); }
    .panel-content { padding:0.8rem; overflow:auto; max-height:520px; }

    .gazette-list-item { padding:0.6rem; border-radius:6px; display:flex; justify-content:space-between; gap:0.5rem; cursor:pointer; border:1px solid transparent; }
    .gazette-list-item:hover { background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.02); }
    .gazette-selected { background: rgba(59,130,246,0.08); border-color: rgba(59,130,246,0.08); }

    .html-iframe { width:100%; height:560px; border:none; background:white; }

    .meta { color:var(--muted); font-size:0.85rem; }

    .loading { display:flex; align-items:center; justify-content:center; padding:2rem; color:var(--muted); }
    .spinner { width:18px; height:18px; border:2px solid var(--border); border-top:2px solid var(--accent); border-radius:50%; animation:spin 1s linear infinite; margin-right:0.5rem; }

    @media (max-width:1024px) { .dashboard-grid{grid-template-columns:1fr;} .gazette-viewer{grid-template-columns:1fr; } .html-iframe{height:360px;} }

    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

    ::-webkit-scrollbar { width:8px; } ::-webkit-scrollbar-track { background: var(--bg); } ::-webkit-scrollbar-thumb { background: var(--border); border-radius:4px; } ::-webkit-scrollbar-thumb:hover { background: var(--hover); }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo">Daily Hub</div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>Live Dashboard</span>
      </div>
    </div>
  </header>

  <main class="main-container">
    <div class="dashboard-grid">
      <!-- Wordle & Globle cards unchanged -->
      <div class="game-card" id="wordle-card">
        <div class="card-header">
          <div class="card-title"> üéØ Wordle
            <span class="status-badge status-loading" id="wordle-status"><div class="spinner"></div>Loading</span>
          </div>
          <div class="card-subtitle">Daily word puzzle from The New York Times</div>
          <div class="card-controls">
            <button class="btn btn-primary" onclick="refreshWordle()">üîÑ Refresh</button>
            <a class="btn btn-secondary" href="https://www.nytimes.com/games/wordle/index.html" target="_blank">üîó Open Direct</a>
          </div>
        </div>
        <iframe id="wordle-frame" class="game-frame" src="https://www.nytimes.com/games/wordle/index.html" title="Wordle Game" loading="lazy"></iframe>
        <div class="fallback-message"><h3>Unable to load Wordle</h3><p>The game might be blocked by your browser or network settings.</p></div>
      </div>

      <div class="game-card" id="globle-card">
        <div class="card-header">
          <div class="card-title"> üåç Globle
            <span class="status-badge status-loading" id="globle-status"><div class="spinner"></div>Loading</span>
          </div>
          <div class="card-subtitle">Daily geography guessing game</div>
          <div class="card-controls">
            <button class="btn btn-primary" onclick="refreshGlobe()">üîÑ Refresh</button>
            <a class="btn btn-secondary" href="https://globle-game.com/" target="_blank">üîó Open Direct</a>
          </div>
        </div>
        <iframe id="globle-frame" class="game-frame" src="https://globle-game.com/" title="Globle Game" loading="lazy"></iframe>
        <div class="fallback-message"><h3>Unable to load Globle</h3><p>The game might be blocked by your browser or network settings.</p></div>
      </div>

      <!-- Gazette Card -->
      <div class="gazette-card">
        <div class="card-header">
          <div class="card-title"> üì∞ Daily Gazette
            <span class="status-badge status-loading" id="gazette-status"><div class="spinner"></div>Fetching</span>
          </div>
          <div class="card-subtitle">Auto-fetch via JSON-RPC ‚Äî paste URL and auth headers if site requires login</div>
          <div class="card-controls">
            <button class="btn btn-primary" onclick="fetchGazette()">üîÑ Refresh Gazette</button>
            <button class="btn btn-secondary" onclick="toggleGazetteView()">üëÅÔ∏è Toggle View</button>
          </div>
        </div>

        <div class="gazette-content">
          <div class="gazette-toolbar">
            <input id="gazette-url" class="input-field" placeholder="JSON-RPC or direct Gazette URL (e.g. https://www.ofs.edu.sg/my-ofs/Gazette.jsp?gazetteId=5960)" value="https://www.ofs.edu.sg/my-ofs/Gazette.jsp?gazetteId=5960" />
            <input id="known-id" class="input-field small-input" placeholder="start gazetteId (optional, e.g. 5916)" />
            <input id="cookie-header" class="input-field small-input" placeholder="Cookie header (paste session cookie if needed)" />
            <button class="btn btn-primary mini" onclick="fetchGazette()">Fetch</button>
            <button class="btn btn-secondary mini" onclick="discoverLatest()">Find latest accessible ID</button>
            <button class="btn mini" onclick="loadDemoGazette()">Load Demo</button>
          </div>

          <div class="gazette-viewer">
            <div class="left-col">
              <div class="list-card">
                <div class="panel-header">Gazette Index</div>
                <div id="gazette-list" class="panel-content">
                  <div class="meta">No gazettes loaded yet. Use 'Fetch' or 'Find latest accessible ID'.</div>
                </div>
              </div>

              <div class="detail-card">
                <div class="panel-header">Gazette Meta</div>
                <div id="gazette-meta" class="panel-content">
                  <div class="meta">Select a gazette from the list to see metadata.</div>
                </div>
              </div>
            </div>

            <div class="html-card">
              <div class="panel-header">HTML Preview</div>
              <div class="panel-content" style="padding:0;">
                <iframe id="gazette-html-frame" class="html-iframe" title="Gazette HTML Content" sandbox="allow-same-origin allow-scripts"></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // --- App state ---
    const AppState = {
      gazetteData: null,
      gazetteUrl: document.getElementById('gazette-url').value || '',
      customHeaders: {},
      viewMode: 'split'
    };

    // --- tiny helpers ---
    function updateStatus(id, text, kind='loading') {
      const el = document.getElementById(id);
      if (!el) return;
      const classes = { loading: 'status-loading', success: 'status-success', error: 'status-error' };
      el.className = 'status-badge ' + (classes[kind] || classes.loading);
      el.innerHTML = (kind === 'loading' ? '<div class="spinner"></div>' : '') + text;
    }

    function showError(msg, id='gazette-status') {
      console.error('Gazette Error:', msg);
      updateStatus(id, 'Error: ' + msg, 'error');
    }

    function formatJsonForDisplay(data) { try { return JSON.stringify(data, null, 2); } catch (e) { return String(data); } }

    // --- fetch with optional custom headers (Cookie, Authorization, etc) ---
    async function fetchWithHeaders(url, opts = {}) {
      const headers = new Headers(opts.headers || {});
      // if user pasted Cookie header
      const cookieVal = document.getElementById('cookie-header').value.trim();
      if (cookieVal) {
        headers.set('Cookie', cookieVal);
      }
      const fetchOpts = {
        method: opts.method || 'GET',
        headers,
        mode: opts.mode || 'cors',
        credentials: opts.credentials || 'omit', // don't automatically send credentials
        cache: 'no-cache'
      };
      return fetch(url, fetchOpts);
    }

    // Robust JSON/HTML fetcher
    async function fetchJsonRpc(url, options = {}) {
      try {
        const resp = await fetchWithHeaders(url, options);
        // If the site returns a redirect (login page) browsers often don't expose redirect URL because of CORS.
        if (!resp.ok) {
          throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
        }
        const ct = resp.headers.get('content-type') || '';
        if (ct.includes('application/json')) {
          return await resp.json();
        } else {
          const text = await resp.text();
          // try parse JSON
          try { return JSON.parse(text); } catch (e) { return { html: text, contentType: ct }; }
        }
      } catch (err) {
        // bubble up
        throw err;
      }
    }

    // --- Display logic: render monthlyGazettes or single gazette ---
    function renderGazetteIndex(data) {
      const listEl = document.getElementById('gazette-list');
      listEl.innerHTML = '';
      // Prefer monthlyGazettes (gazette.min.js structure)
      if (data && data.monthlyGazettes && Array.isArray(data.monthlyGazettes)) {
        data.monthlyGazettes.forEach(month => {
          const monthHeader = document.createElement('div');
          monthHeader.style.fontWeight = '700';
          monthHeader.style.padding = '6px 0';
          monthHeader.textContent = month.monthYear || 'Month';
          listEl.appendChild(monthHeader);
          if (Array.isArray(month.gazettes)) {
            month.gazettes.forEach(g => {
              const item = document.createElement('div');
              item.className = 'gazette-list-item';
              item.dataset.gazetteId = g.gazetteId;
              item.innerHTML = `<div><div style="font-weight:600">${g.header||g.title||'Untitled'}</div><div class="meta">${new Date(g.gazetteDate).toLocaleDateString()}</div></div><div class="meta">#${g.gazetteId}</div>`;
              item.onclick = () => selectGazetteFromList(g.gazetteId);
              listEl.appendChild(item);
            });
          }
        });
        return;
      }

      // If server returned list array at result.monthlyGazettes or result.gazettes
      if (data && data.result && data.result.monthlyGazettes) {
        return renderGazetteIndex(data.result);
      }

      if (data && data.result && Array.isArray(data.result.gazettes)) {
        // simple flat array
        data.result.gazettes.forEach(g => {
          const item = document.createElement('div');
          item.className = 'gazette-list-item';
          item.dataset.gazetteId = g.gazetteId;
          item.innerHTML = `<div><div style="font-weight:600">${g.header||g.title||'Untitled'}</div><div class="meta">${new Date(g.gazetteDate).toLocaleDateString()}</div></div><div class="meta">#${g.gazetteId}</div>`;
          item.onclick = () => selectGazetteFromList(g.gazetteId);
          listEl.appendChild(item);
        });
        return;
      }

      // No index available, maybe we have a single gazette only
      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = 'No index found in response. You may have received a single gazette or HTML content.';
      listEl.appendChild(meta);
    }

    function renderGazetteMeta(g) {
      const d = document.getElementById('gazette-meta');
      d.innerHTML = '';
      if (!g) { d.innerHTML = '<div class="meta">No gazette selected</div>'; return; }
      const html = `
        <div style="margin-bottom:8px;">
          <div style="font-weight:700">${g.header || g.title || 'Untitled'}</div>
          <div class="meta">ID: ${g.gazetteId || '‚Äî'} ‚Ä¢ ${g.schoolId ? 'School: ' + g.schoolId : ''}</div>
          <div class="meta">${g.gazetteDate ? new Date(g.gazetteDate).toLocaleString() : ''}</div>
        </div>
        <div style="font-size:0.92rem; color:var(--muted)">${(g.summary || g.description || '').slice(0, 400)}</div>
      `;
      d.innerHTML = html;
    }

    function displayHtmlContent(htmlContent) {
      const frame = document.getElementById('gazette-html-frame');
      if (!frame) return;
      if (!htmlContent) {
        // generate no-content
        const noContent = `<html><body style="font-family:system-ui;padding:40px;color:#333;"><h3>No HTML content</h3><p>The JSON-RPC response did not contain an HTML payload.</p></body></html>`;
        frame.src = URL.createObjectURL(new Blob([noContent], {type:'text/html'}));
        return;
      }
      // attach blob
      frame.src = URL.createObjectURL(new Blob([htmlContent], { type: 'text/html' }));
    }

    function selectGazetteFromList(gazetteId) {
      updateStatus('gazette-status', 'Loading gazette #'+gazetteId, 'loading');
      // if the AppState.gazetteData contains monthlyGazettes, find it locally; otherwise attempt fetch by URL param
      const dd = AppState.gazetteData;
      if (dd) {
        // try to find locally
        function findInMonthly(monthly) {
          for (const m of monthly || []) {
            for (const g of m.gazettes || []) {
              if (Number(g.gazetteId) === Number(gazetteId)) return g;
            }
          }
          return null;
        }
        let found = null;
        if (dd.monthlyGazettes) found = findInMonthly(dd.monthlyGazettes);
        if (!found && dd.result && dd.result.monthlyGazettes) found = findInMonthly(dd.result.monthlyGazettes);
        if (found) {
          renderGazetteMeta(found);
          // display HTML if present
          if (found.content) displayHtmlContent(found.content);
          else if (found.html) displayHtmlContent(found.html);
          else if (AppState.gazetteData && AppState.gazetteData.html) displayHtmlContent(AppState.gazetteData.html);
          else displayHtmlContent('');
          updateStatus('gazette-status', 'Loaded #' + gazetteId, 'success');
          return;
        }
      }

      // fallback: try fetching the specific page URL (common pattern) by appending ?gazetteId=#
      // build URL from base (gazette-url field)
      try {
        const base = (document.getElementById('gazette-url').value || '').split('?')[0] || '';
        if (!base) { showError('No base URL to fetch by ID'); return; }
        const url = base + '?gazetteId=' + encodeURIComponent(gazetteId);
        fetchJsonRpc(url)
          .then(resp => {
            AppState.gazetteData = resp;
            // attempt to parse for single gazette
            let g = null;
            if (resp.result && resp.result.gazette) g = resp.result.gazette;
            if (!g && resp.gazette) g = resp.gazette;
            if (g) {
              renderGazetteMeta(g);
              if (g.content) displayHtmlContent(g.content);
              else if (g.html) displayHtmlContent(g.html);
              else if (resp.html) displayHtmlContent(resp.html);
              else displayHtmlContent('');
            } else {
              renderGazetteMeta({ gazetteId });
              if (resp.html) displayHtmlContent(resp.html);
              else if (resp.result && typeof resp.result === 'string' && resp.result.includes('<')) displayHtmlContent(resp.result);
              else displayHtmlContent('');
            }
            updateStatus('gazette-status', 'Loaded #' + gazetteId, 'success');
          })
          .catch(err => {
            showError('Failed to load gazette #' + gazetteId + ' ‚Äî ' + err.message);
          });
      } catch (e) {
        showError(e.message);
      }
    }

    // main fetch routine
    async function fetchGazette() {
      const url = document.getElementById('gazette-url').value.trim();
      if (!url) { showError('No gazette URL set'); return; }
      updateStatus('gazette-status', 'Fetching', 'loading');
      try {
        const data = await fetchJsonRpc(url);
        AppState.gazetteData = data;
        // display raw & index
        renderGazetteIndex(data);
        // if single gazette, attempt to render it
        if (data.result && data.result.gazette) {
          renderGazetteMeta(data.result.gazette);
          if (data.result.gazette.content) displayHtmlContent(data.result.gazette.content);
          else if (data.result.gazette.html) displayHtmlContent(data.result.gazette.html);
        } else if (data.gazette) {
          renderGazetteMeta(data.gazette);
          if (data.html) displayHtmlContent(data.html);
          else if (data.gazette.content) displayHtmlContent(data.gazette.content);
        } else if (data.html) {
          // server returned HTML directly
          displayHtmlContent(data.html);
          document.getElementById('gazette-meta').innerHTML = '<div class="meta">HTML content returned</div>';
        } else if (data.result && data.result.html) {
          displayHtmlContent(data.result.html);
        } else {
          // nothing obvious ‚Äî show raw JSON in meta
          document.getElementById('gazette-meta').innerHTML = '<pre class="meta" style="white-space:pre-wrap;">' + escapeHtml(formatJsonForDisplay(data)).slice(0, 2000) + '</pre>';
          displayHtmlContent('');
        }
        updateStatus('gazette-status', 'Updated', 'success');
      } catch (err) {
        console.error(err);
        showError(err.message);
        // fallback to demo
        // keep demo not forced ‚Äî only if user wants:
      }
    }

    // find latest accessible by probing the direct Gazette.jsp page (bounded)
    async function discoverLatest() {
      const baseRaw = document.getElementById('gazette-url').value.trim();
      if (!baseRaw) { showError('No base URL to probe'); return; }
      // Determine base (strip query)
      const base = baseRaw.split('?')[0];
      if (!base) { showError('Invalid base URL'); return; }

      updateStatus('gazette-status', 'Discovering latest...', 'loading');

      // starting point: from user's known-id or a high estimate
      let startId = parseInt(document.getElementById('known-id').value || '') || (new Date().getFullYear() * 10 + 1000); // fallback
      // if known id unhelpful, use 6000 default (you reported ~5916 recently)
      if (!Number.isFinite(startId) || startId < 1 || startId > 9999999) startId = 6000;

      const maxProbes = 200; // safety cap
      let found = null;

      // Strategy: try up (increasing) until we hit consecutive failures, then step down to find last success
      try {
        // helper to check if an id returns content (we look for HTTP 200 + some HTML or json)
        async function probe(id) {
          const url = base + '?gazetteId=' + encodeURIComponent(id);
          try {
            const resp = await fetchWithHeaders(url, { method: 'GET', mode: 'cors' });
            if (!resp.ok) {
              // 401/403/302 etc.
              return { ok: false, status: resp.status, text: null };
            }
            const ct = resp.headers.get('content-type') || '';
            const text = await resp.text();
            // detect redirect to login by searching for common login phrases or lack of content
            const lowered = text.toLowerCase();
            const looksLikeLogin = lowered.includes('login') || lowered.includes('sign in') || lowered.includes('please login') || lowered.includes('my-ofs login');
            const looksLikeEmpty = text.trim().length < 50;
            if (ct.includes('application/json')) {
              return { ok: true, status: 200, json: JSON.parse(text), text };
            } else {
              // treat html that doesn't look like login/empty as success
              if (!looksLikeLogin && !looksLikeEmpty) return { ok: true, status: 200, text };
              return { ok: false, status: 200, text, reason: 'login-or-empty' };
            }
          } catch (e) {
            return { ok: false, status: 0, error: e };
          }
        }

        // try stepping up
        let consecutiveFailures = 0;
        let id = startId;
        let probes = 0;
        while (probes < maxProbes && consecutiveFailures < 10) {
          probes++;
          const res = await probe(id);
          if (res.ok) {
            found = id;
            consecutiveFailures = 0;
            id = id + Math.max(1, Math.floor((probes)/5)); // grow a bit to speed up
          } else {
            consecutiveFailures++;
            id++;
          }
        }

        if (!found) {
          // fallback: try downwards from startId
          consecutiveFailures = 0;
          let id2 = startId;
          probes = 0;
          while (probes < maxProbes && consecutiveFailures < 10 && id2 > 1) {
            probes++;
            id2--;
            const res = await probe(id2);
            if (res.ok) { found = id2; break; }
            consecutiveFailures++;
          }
        }

        if (found) {
          updateStatus('gazette-status', 'Latest accessible ID: ' + found, 'success');
          // fill known-id field and attempt to load it
          document.getElementById('known-id').value = found;
          selectGazetteFromList(found);
        } else {
          showError('No accessible gazette found in probe range. Likely blocked by login/CORS or your session is not valid.');
        }
      } catch (e) {
        showError('Discovery failed: ' + (e.message || e));
      }
    }

    // Demo loader (kept but improved styling)
    function loadDemoGazette() {
      updateStatus('gazette-status', 'Loading demo', 'loading');
      const demoData = {
        jsonrpc: "2.0",
        id: "gazette-demo-"+Date.now(),
        monthlyGazettes: [
          {
            monthYear: "August 2025",
            gazettes: [
              { gazetteId: 5960, header: "Demo Gazette 5960", gazetteDate: (new Date()).toISOString(), content: "<h1>Demo 5960</h1><p>This is demo content.</p>" },
              { gazetteId: 5916, header: "Demo Gazette 5916", gazetteDate: (new Date(Date.now()-86400000*7)).toISOString(), content: "<h1>Demo 5916</h1><p>Older demo content.</p>" }
            ]
          }
        ],
        html: `
          <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><style>body{font-family:system-ui;padding:20px}h1{color:#1f2937}</style></head><body><h1>Demo Gazette</h1><p>This is a demo preview loaded locally.</p></body></html>
        `
      };
      AppState.gazetteData = demoData;
      renderGazetteIndex(demoData);
      displayHtmlContent(demoData.html);
      updateStatus('gazette-status', 'Demo loaded', 'success');
    }

    // escape helper for display
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, function(m) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
    }

    // Toggle view (keeps behavior minimal)
    function toggleGazetteView() {
      const v = AppState.viewMode === 'split' ? 'html-only' : AppState.viewMode === 'html-only' ? 'data-only' : 'split';
      AppState.viewMode = v;
      const viewer = document.querySelector('.gazette-viewer');
      if (!viewer) return;
      if (v === 'html-only') {
        viewer.style.gridTemplateColumns = '0 1fr';
      } else if (v === 'data-only') {
        viewer.style.gridTemplateColumns = '340px 0';
      } else {
        viewer.style.gridTemplateColumns = '340px 1fr';
      }
      const btn = document.querySelector('[onclick="toggleGazetteView()"]');
      if (btn) btn.textContent = v === 'split' ? 'üëÅÔ∏è Split View' : v === 'html-only' ? 'üìÑ HTML Only' : 'üìä Data Only';
    }

    // Iframe helpers for Wordle/Globle
    function setupGameIframe(iframeId, cardId, gameName) {
      const iframe = document.getElementById(iframeId);
      const card = document.getElementById(cardId);
      const statusId = `${gameName.toLowerCase()}-status`;
      if (!iframe || !card) return;
      updateStatus(statusId, 'Loading', 'loading');
      iframe.onload = () => { setTimeout(()=> updateStatus(statusId, 'Loaded', 'success'), 1200); };
      iframe.onerror = () => { updateStatus(statusId, 'Failed to Load', 'error'); card.classList.add('error'); };
      setTimeout(()=> {
        try {
          const d = iframe.contentDocument || iframe.contentWindow?.document;
          if (!d) updateStatus(statusId, 'Loaded (External)', 'success');
        } catch(e) { updateStatus(statusId, 'Loaded (External)', 'success'); }
      }, 4000);
    }

    function refreshWordle() { updateStatus('wordle-status','Refreshing','loading'); document.getElementById('wordle-frame').src = document.getElementById('wordle-frame').src; }
    function refreshGlobe() { updateStatus('globle-status','Refreshing','loading'); document.getElementById('globle-frame').src = document.getElementById('globle-frame').src; }

    // init
    document.addEventListener('DOMContentLoaded', () => {
      setupGameIframe('wordle-frame','wordle-card','Wordle');
      setupGameIframe('globle-frame','globle-card','Globle');
      // set initial url
      const urlInput = document.getElementById('gazette-url');
      AppState.gazetteUrl = urlInput.value;
      // load demo so UI isn't empty
      loadDemoGazette();
    });

    // export functions to window so buttons work
    window.fetchGazette = fetchGazette;
    window.loadDemoGazette = loadDemoGazette;
    window.toggleGazetteView = toggleGazetteView;
    window.discoverLatest = discoverLatest;
    window.refreshWordle = refreshWordle;
    window.refreshGlobe = refreshGlobe;
  </script>
</body>
</html>
